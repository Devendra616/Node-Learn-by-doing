
<h1>Edit Post <%=post.title %></h1>


<form action="/posts/<%= post.id %>?_method=PUT" method="POST" id="postEditForm" enctype="multipart/form-data">
    <input type="text" name='post[title]' placeholder="Title" value="<%=post.title %>">
    <input type="text" name='post[price]' placeholder="Price" value='<%= post.price %>'>
   <div> 
       <input type="file" name="images" id="imageUpload" accept="images/*" multiple />
        <div>
            <% post.images.forEach(function(image,i){ %>
                 <img src="<%= image.url %>" width="80px"/>
                 <label for="image<%= i %>">Delete?</label>
                 <input type="checkbox" id="image<%= i %>" name="deleteImages[]" class="imageDeleteCheckbox" value="<%= image.public_id %>">
            <%  }); %>
        </div>
    </div>
    <textarea name="post[description]" id="description" placeholder="Description"><%= post.description %></textarea>
    <input type="text" name="post[location]" placeholder="Location" value='<%= post.location %>'>
    <input type="submit">
</form>

<script>
 let postEditForm = document.getElementById("postEditForm");
 //add submit listener to form
 postEditForm.addEventListener("submit",function(event){
        //find no of uploaded images
        let imageUploads = document.getElementById("imageUpload").files.length;
        //find no of existing images
        let existingImgs = document.querySelectorAll(".imageDeleteCheckbox").length;
        //find no of potential deletions
        let imageDeletions = document.querySelectorAll(".imageDeleteCheckbox:checked").length;

        //check if images are full
        newTotal = existingImgs-imageDeletions+imageUploads;
        if(newTotal >4 ){
            event.preventDefault();
            let removeAmt = newTotal - 4;   
            alert(`You need to remove atleast ${removeAmt} (more) image${removeAmt ===1?'':'s'}`);

        }
 });
 


 //find total no of existing images


</script>
